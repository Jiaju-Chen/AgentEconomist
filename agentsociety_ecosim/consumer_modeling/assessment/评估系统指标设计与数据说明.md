# 消费者模型评估系统指标设计与数据说明

## 目录

1. [数据来源与结构](#数据来源与结构)
   - 1.1 [历史家庭数据（PSID数据集）](#1-历史家庭数据psid数据集)
   - 1.2 [LLM输出数据](#2-llm输出数据)

2. [核心评估指标设计](#核心评估指标设计)
   - 2.1 [预算一致性得分](#1-预算一致性得分)
   - 2.2 [商品画像一致性得分](#2-商品画像一致性得分)
   - 2.3 [商品多样性得分](#3-商品多样性得分)
   - 2.4 [家庭异质性得分](#4-家庭异质性得分)

3. [支出类别映射](#13个支出类别映射)

4. [评估结果总结](#评估结果总结)

---

## 数据来源与结构

### 1. 历史家庭数据（PSID数据集）

**数据路径**: `consumer_modeling/household_data/PSID/extracted_data/processed_data/integrated_psid_families_data.json`

**数据结构**:
```json
{
  "families": {
    "family_id": {
      "basic_family_info": {
        "family_size": "家庭人数",
        "head_age": "户主年龄", 
        "head_gender": "户主性别",
        "head_marital_status": "婚姻状况",
        "num_children": "子女数量",
        "num_vehicles": "车辆数量",
        "life_satisfaction": "生活满意度"
      },
      "family_wealth_situation": {
        "wealth_analysis": "财务状况分析"
      },
      "expenditure_categories": {
        "food_expenditure": [历年食品支出],
        "clothing_expenditure": [历年服装支出],
        "education_expenditure": [历年教育支出],
        "childcare_expenditure": [历年儿童保育支出],
        "electronics_expenditure": [历年电子产品支出],
        "home_furnishing_equipment": [历年家具设备支出],
        "other_recreation_expenditure": [历年其他娱乐支出],
        "housing_expenditure": [历年住房支出],
        "utilities_expenditure": [历年公用事业支出],
        "transportation_expenditure": [历年交通支出],
        "healthcare_expenditure": [历年医疗保健支出],
        "travel_expenditure": [历年旅行支出],
        "phone_internet_expenditure": [历年电话/互联网支出]
      }
    }
  }
}
```

### 2. LLM输出数据

**数据路径**: `consumer_modeling/output/`

**目录结构**:
```
output/
├── family{id}/
│   ├── annual_budget_allocation_family_{id}.json     # 年度预算分配
│   ├── monthly_shopping_plan_family_{id}.json        # 月度购物计划
│   ├── monthly_cat_budget_family_{id}.json           # 月度类别预算分配
│   └── monthly_subcat_budget_family_{id}.json        # 月度子类别预算分配
```

**年度预算分配结构**:
```json
{
  "category_allocations": {
    "food_expenditure": 预算金额,
    "clothing_expenditure": 预算金额,
    "education_expenditure": 预算金额,
    // ... 其他13个支出类别
  }
}
```

**月度购物计划结构**:
```json
{
  "month_1": {
    "category": {
      "subcategory": [
        {
          "name": "商品名称",
          "quantity": 购买数量,
          "price": 商品价格
        }
      ]
    }
  }
}
```

**月度类别预算分配结构**:
```json
{
  "food_expenditure": [月度预算金额数组],
  "clothing_expenditure": [月度预算金额数组],
  "education_expenditure": [月度预算金额数组],
  // ... 其他13个支出类别，每个包含12个月的预算分配
}
```

**月度子类别预算分配结构**:
```json
{
  "1": {
    "food_expenditure": {
      "food": 月度预算金额
    },
    "clothing_expenditure": {
      "clothing": 月度预算金额
    },
    "education_expenditure": {
      "office supplies": 月度预算金额,
      "books": 月度预算金额
    },
    // ... 按月份和子类别组织的详细预算分配
  },
  "2": {
    // 第2个月的子类别预算分配
  }
  // ... 其他月份
}
```

**文件功能说明**:
- **annual_budget_allocation**: 年度总预算在13个主要支出类别上的分配，用于预算一致性评估
- **monthly_shopping_plan**: 具体的商品购买清单，包含商品名称、数量和价格，用于商品多样性和画像一致性评估
- **monthly_cat_budget**: 年度预算按月度分解到13个主要类别的分配情况，体现消费的季节性规律
- **monthly_subcat_budget**: 更细粒度的月度预算分配，将主类别进一步细分为子类别，提供更详细的消费结构信息

## 核心评估指标设计

### 1. 预算一致性得分

**目标**: 评估LLM预算分配与家庭历史消费模式的一致性


**1. 绝对预测误差MAPE (Mean Absolute Percentage Error)**
- **计算方法**: 对每个支出类别计算 |实际值-预测值|/实际值，然后取平均
- **含义**: 衡量LLM预测的绝对金额与实际支出的偏差程度
- **公式**: `MAPE = mean(|actual - predicted| / actual)`
- **取值范围**: [0, +∞)，值越小表示预测越准确

**2. 预测结构相似度**
- **计算方法**: 将实际2021年支出和LLM预测支出分别转换为比例结构，计算皮尔逊相关系数
- **含义**: 衡量LLM预测的支出结构与实际支出结构的相似程度
- **公式**: `相似度 = pearsonr(actual_ratios, predicted_ratios)`
- **取值范围**: [-1, 1]，值越高表示结构预测越相似

**3. 传统一致性得分**
- **计算方法**: 基于前5年历史数据计算加权平均支出结构，与LLM预测结构计算相关系数
- **含义**: 衡量LLM预测是否延续了家庭的历史消费趋势
- **公式**: `一致性 = pearsonr(historical_weighted_structure, predicted_structure)`
- **取值范围**: [-1, 1]，值越高表示与历史趋势越一致


**实际评估结果** (基于最新500个家庭的评估):
- **新增预测验证指标**:
  - **平均绝对预测误差MAPE**: 0.373 (37.3%的预测误差)
  - **平均预测结构相似度**: 0.889 (与预算一致性得分完全一致)
  - **平均传统一致性得分**: 0.735 (基于历史趋势的一致性)
- **得分稳定性**: 预算一致性与结构相似度完全一致，显示指标测量的一致性

**结果分析与意义**:
1. **预测准确性中等**: MAPE为0.373表明LLM预测各类支出与实际值平均偏差37.3%，仍有较大提升空间，特别是对于支出波动较大的家庭。

2. **结构一致性优异**: 预算一致性得分与结构相似度均为0.889，说明LLM虽然在绝对金额预测上有偏差，但在支出结构(各类别比例)的把握上表现优秀。

3. **历史趋势捕捉良好**: 传统一致性得分0.735表明LLM能够较好地学习和延续家庭的历史消费趋势，体现了对长期消费模式的理解能力。





### 2. 商品画像一致性得分

**目标**: 评估商品选择与家庭画像的匹配度

**计算方法**:
1. **家庭画像提取**:
   - 从历史数据提取人口统计信息（年龄、性别、家庭规模等）
   - 财务状况分析（收入趋势、财务稳定性）
   - 生活方式特征（车辆拥有情况、生活满意度等）

2. **代表性商品提取**:
   - 统计所有月份的商品购买记录
   - 按购买数量排序，提取前20个代表性商品

3. **LLM评估**:
   - 构建评估提示，包含家庭画像和商品清单
   - 从四个维度评估匹配度：
     - 收入水平匹配（商品价格与家庭收入的符合度）
     - 家庭规模适配（商品数量与家庭人数的合理性）
     - 生活方式契合（商品类型与家庭特征的一致性）
     - 整体协调性（商品组合的逻辑性）

**实际评估结果** (基于最新500个家庭的评估):
- **平均商品画像一致性得分**: 0.835 (与之前保持一致)
- **得分稳定性**: 评估结果相对稳定，标准差较小
- **评估质量**: 通过LLM自评估机制确保了评分的客观性和一致性
- **个体差异**: 大部分家庭得分集中在0.70-0.90区间，少数家庭表现突出或需要改进

**结果分析与意义**:
1. **高度匹配性**: 平均得分0.835表明LLM在商品选择方面表现优异，能够准确理解家庭画像特征并选择相应的商品组合，体现了强大的情境理解能力。

2. **相对稳定表现**: 相比预算预测的37.3%误差，商品画像匹配度保持在较高水平，说明LLM在理解用户需求和偏好方面具有优势。

3. **实用价值高**: 高一致性得分表明该模型能够应用于实际的个性化推荐场景，为用户提供符合其画像特征的商品建议。

4. **质量保证机制**: 采用LLM自评估的方式，通过多维度评估(收入匹配、家庭适配、生活方式契合、整体协调性)确保了评估结果的全面性和可靠性。

### 3. 商品多样性得分+

**目标**: 评估商品选择的多样性和丰富度

**计算方法**:
商品多样性由三个子指标加权计算：

1. **类别多样性** (权重50%)
   - 统计购买的商品类别数量和分布
   - 使用香农多样性指数衡量类别分布均匀程度
   - 类别越多、分布越均匀，得分越高

2. **价格覆盖度** (权重30%)  
   - 将商品价格分为10个区间
   - 计算覆盖的价格区间数量
   - 价格跨度大、覆盖区间多得分更高

3. **数量多样性** (权重20%)
   - 分析购买数量的变化程度
   - 综合考虑数量标准差、取值范围和分布均匀性
   - 既有大量购买又有少量购买得分更高

**综合得分**: `多样性得分 = 类别多样性×0.5 + 价格覆盖度×0.3 + 数量多样性×0.2`

**实际评估结果** (基于最新500个家庭的评估):
- **平均商品多样性得分**: 0.914 (综合得分，保持最高水平)
- **子指标表现** (基于评估报告推算):
  - 类别多样性: 约0.880，平均覆盖18-20个商品子类别
  - 价格覆盖度: 约0.960，平均覆盖9-10个价格区间  
  - 数量多样性: 约0.950，购买数量分布合理且富有变化
- **优秀表现比例**: 约88%的家庭得分在0.85-1.0之间
- **极端案例**: 少数家庭存在类别多样性为负值的异常情况，需要数据清理

**结果分析**:
1. **卓越的多样性表现**: 平均得分0.914依然为所有指标中最高，LLM在生成丰富多元且现实合理的购物清单方面表现出色，体现了强大的商品组合能力。

2. **价格覆盖全面**: 价格覆盖度得分最高(~0.960)，成功避免了价格单一化问题，能够生成跨越不同价格区间的商品组合，符合真实购物行为。

3. **类别分布均衡**: 类别多样性得分约0.880，实现了相对均衡的类别分布，避免了过度集中在某些商品类别的问题。

4. **数据质量问题**: 发现个别家庭存在类别多样性为负值的异常情况，可能由于商品数据缺失或算法处理异常，需要在后续版本中完善数据清理机制。

### 4. 家庭异质性得分

**目标**: 评估不同家庭间的差异化程度

**核心思路**: 基于"组内相似、组间差异"的评估策略
- 相似家庭应该有相似的消费行为（组内相似度**高**）
- 不同类型家庭应该有明显差异（组间相似度**低**）
- **理想情况**: 组内相似度接近1，组间相似度接近0

**计算步骤**:

#### 第1步：构建特征向量
为每个家庭构建三类特征向量：
1. **商品向量**: 基于TF-IDF的商品类别偏好向量
2. **预算向量**: 13个支出类别的比例分配向量  
3. **行为向量**: 价格偏好、购买数量、购买频率等11个行为特征

#### 第2步：家庭聚类分析
- 将特征向量组合并标准化
- 使用K-means聚类，自动选择最优聚类数（8-25个）
- 基于轮廓系数选择最佳聚类方案

#### 第3步：计算异质性得分
对三个维度分别计算：
- **组内相似度**: 同一聚类内家庭的平均相似度
- **组间相似度**: 不同聚类间家庭的平均相似度
- **异质性得分**: `(组内相似度 - 组间相似度) / (组内相似度 + 组间相似度)`

**综合得分**: `异质性得分 = 商品异质×0.4 + 预算异质×0.35 + 行为异质×0.25`

**实际评估结果** (基于最新500个家庭的评估):
- **综合异质性得分**: 0.565 (较之前轻微提升)
- **子指标表现**:
  - **商品选择异质性**: 0.644 (组内0.756，组间0.418) ✓ 符合预期
  - **预算分配异质性**: 0.509 (组内0.817，组间0.789) ❌ 组间仍然过高
  - **购买模式异质性**: 0.518 (组内0.870，组间0.811) ❌ 组间依然过高
- **聚类分析结果**: 
  - 识别出14个家庭类型(与之前15个略有减少)
  - 聚类质量得分: 0.174 (轮廓系数，依然偏低)
  - 最大群体: "中低收入中年期二孩家庭" (71个家庭)
  - 最小群体: "超高收入老年期夫妻二人" (1个家庭)
- **质量验证指标**:
  - 聚类稳定性: 0.760 (表现良好)
  - 期望符合度: 1.0 (完全符合常识期望)
  - 语义一致性和统计显著性: 0.0 (需要改进)

**异质性表现持续存在的问题**:
预算分配和购买模式的组间相似度持续过高(0.789和0.811)，说明：
1. **聚类边界依然模糊**: 不同类型家庭在预算和行为上差异不够明显
2. **特征工程需要优化**: 当前特征向量仍无法有效区分家庭类型  
3. **同质化倾向持续**: LLM在生成个性化消费行为时仍存在模式化倾向

**积极改进**:
1. **聚类稳定性提升**: 从之前的不稳定状态提升到0.760，显示聚类结果更加可靠
2. **期望符合度满分**: 说明聚类结果完全符合常识和专家期望，具有良好的可解释性
3. **商品异质性保持优势**: 0.644的得分依然表明LLM能够根据家庭特征生成显著不同的商品选择

**结果分析**:
1. **商品选择异质性表现最佳**: 组内0.74 > 组间0.42，差异明显，说明LLM能够根据家庭画像生成显著不同的商品组合
2. **预算分配聚类效果差**: 组内0.82 ≈ 组间0.79，差异很小，说明不同类型家庭的预算分配模式过于相似
3. **购买行为区分度不足**: 组内0.87 ≈ 组间0.81，表明LLM在行为模式上缺乏足够的个性化差异
4. **聚类质量待提升**: 轮廓系数0.174偏低，证实了预算和行为维度的聚类边界模糊
5. **模型同质化倾向**: 除商品选择外，LLM在预算和行为决策上表现出明显的同质化倾向


## 13个支出类别映射

| 英文键名 | 中文名称 | 说明 |
|---------|---------|------|
| food_expenditure | 食品总支出 | 包括在家饮食和外出就餐 |
| clothing_expenditure | 服装支出 | 服装鞋帽等个人着装 |
| education_expenditure | 教育支出 | 学费、教材、培训等 |
| childcare_expenditure | 儿童保育支出 | 托儿所、保姆等育儿费用 |
| electronics_expenditure | 电子产品支出 | 电脑、手机、家电等 |
| home_furnishing_equipment | 家具设备支出 | 家具、装修、家居用品 |
| other_recreation_expenditure | 其他娱乐支出 | 旅游、娱乐、运动等 |
| housing_expenditure | 住房总支出 | 房租、房贷、物业费等 |
| utilities_expenditure | 公用事业总支出 | 水电煤气等基础设施费用 |
| transportation_expenditure | 交通总支出 | 车辆、燃油、公共交通等 |
| healthcare_expenditure | 医疗保健支出 | 医疗费用、保健品等 |
| travel_expenditure | 旅行支出 | 旅游、出差等出行费用 |
| phone_internet_expenditure | 电话/互联网支出 | 通信费用 |


## 评估结果总结

基于最新500个家庭的大规模评估，消费者模型在四个核心维度上的表现如下：

| 评估指标 | 得分 | 排名 | 表现等级 | 关键发现 |
|---------|------|------|----------|----------|
| 商品多样性得分 | 0.914 | 1 | 优秀 | 能够生成丰富多元的购物清单，价格覆盖度最高(~0.96) |
| 预算一致性得分 | 0.889 | 2 | 优秀 | 支出结构预测精准，但绝对金额预测偏差37.3% |
| 商品画像一致性得分 | 0.835 | 3 | 良好 | 商品选择与家庭画像匹配度高，体现强大的情境理解能力 |
| 综合异质性得分 | 0.565 | 4 | 中等 | 家庭间差异化程度中等，聚类质量仍需改进 |

### 核心发现

**模型强项**:
- **商品多样性**: LLM在生成多元化商品清单方面表现卓越，能够很好地平衡不同类别、价格和数量的商品选择
- **结构预测精准**: 支出结构相似度高达0.889，表明对消费比例分配的理解准确
- **画像匹配优秀**: 商品选择与家庭画像的匹配度高，显示了强大的情境理解和个性化推理能力

**改进空间**:
- **绝对金额预测**: MAPE为37.3%，说明在具体支出金额预测上仍有较大提升空间
- **异质性改进有限**: 虽然聚类稳定性提升至0.760，但预算和行为维度的个性化程度仍然不足
- **特征工程优化**: 需要改进家庭画像特征工程，提高聚类区分度和异质性表现

**数据质量问题**:
- 发现个别家庭存在类别多样性负值的异常情况
- 部分家庭数据可能存在缺失或异常，需要数据清理机制

